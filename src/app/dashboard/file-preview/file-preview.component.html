<!-- file-preview.component.html -->
<div class="preview-container">
  <!-- Backdrop that closes when clicked -->
  <div *ngIf="previewService.hasActivePreview$ | async" 
       class="preview-backdrop" 
       (click)="closeAllPreviews()">
  </div>

  <!-- Unified Preview Modal -->
  <div *ngIf="activePreview$ | async as preview" class="preview-modal">
    <div class="modal-header">
      <h3>{{ preview.fileName }}</h3>
      <div class="header-actions">
        <button *ngIf="preview.downloadUrl" mat-icon-button 
                (click)="downloadFile(preview.downloadUrl, preview.fileName)">
          <mat-icon>download</mat-icon>
        </button>
        <button mat-icon-button (click)="closeAllPreviews()" aria-label="Close preview">
          <mat-icon>close</mat-icon>
        </button>
      </div>
    </div>
    
    <div class="preview-content">
      <!-- Image Preview -->
      <img *ngIf="preview.type === 'image'" 
           [src]="preview.url" 
           [alt]="preview.fileName"
           class="preview-image"
           (load)="onContentLoaded()">
           
      <!-- PDF Preview -->
      <iframe *ngIf="preview.type === 'pdf'"
              [src]="getSafeUrl(preview.url)"
              title="PDF document preview"
              class="preview-iframe"
              (load)="onContentLoaded()"></iframe>
              
      <!-- Office Preview -->
      <iframe *ngIf="preview.type === 'office'"
              [src]="getSafeUrl(preview.url)"
              title="Office document preview"
              class="preview-iframe"
              (load)="onContentLoaded()"></iframe>
              
      <!-- Video Preview -->
      <video *ngIf="preview.type === 'video'"
             controls autoplay class="preview-video"
             (loadeddata)="onContentLoaded()">
        <source [src]="getSafeUrl(preview.url)" 
                [type]="preview.fileType">
      </video>
      
      <!-- Audio Preview -->
      <audio *ngIf="preview.type === 'audio'"
             controls autoplay class="preview-audio"
             (loadeddata)="onContentLoaded()">
        <source [src]="preview.url" 
                [type]="preview.fileType">
      </audio>
      
      <!-- Loading Indicator -->
      <div *ngIf="isLoading" class="loading-spinner">
        <mat-spinner diameter="50"></mat-spinner>
      </div>
    </div>
  </div>
</div>